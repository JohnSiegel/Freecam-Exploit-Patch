package com.sosa.antifreecam;

import com.sun.tools.doclint.HtmlTag;
import org.bukkit.ChatColor;
import org.bukkit.Material;
import org.bukkit.block.Block;
import org.bukkit.block.Chest;
import org.bukkit.block.Dispenser;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.inventory.InventoryOpenEvent;
import org.bukkit.inventory.InventoryHolder;
import org.bukkit.plugin.java.JavaPlugin;

import java.util.HashSet;
import java.util.Set;

public final class Antifreecam extends JavaPlugin implements Listener {

    @Override
    public void onEnable()
    {
        getServer().getPluginManager().registerEvents(this, this);
    }

    @EventHandler
    public void freecamBucket(InventoryOpenEvent e)
    {
        InventoryHolder holder = e.getInventory().getHolder();
        if (holder instanceof Dispenser || holder instanceof Chest)
        {
            Player player = (Player) e.getPlayer();
            Set<Material> transparents = new HashSet<Material>();
            transparents.add(Material.WATER);
            transparents.add(Material.LAVA);
            transparents.add(Material.AIR);
            Block b = player.getTargetBlock(transparents, 4);

            if (b.getType().isSolid() && !(b.getType().equals(Material.CHEST) || b.getType().equals(Material.DISPENSER)))
            {
                player.sendMessage(ChatColor.RED + "You can't reach that!");
                e.setCancelled(true);
            }
        }
    }
}

